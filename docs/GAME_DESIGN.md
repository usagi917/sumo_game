# ゲームデザイン仕様

レトロ風紙相撲バトルゲーム（MVP）のゲームメカニクスとバランス設計を説明します。

## ゲームコンセプト

レトロな8bitスタイルで、**連打アクション**で楽しむ紙相撲シミュレーションゲーム。

### コアメカニクス

**紙相撲シミュレーション**：
- プレイヤーは台をトントン叩く感覚でボタンを連打
- 連打速度 → 振動エネルギー → 力士が前進
- 物理シミュレーションで重心移動・転倒・押し出しを再現

### コアループ（MVP）

```
タイトル画面
    ↓
試合開始
    ↓
1本勝負（AI対戦、1ラウンド）
    ├→ 連打で前進
    ├→ バランス管理
    └→ 相手を倒すor押し出す
    ↓
リザルト表示（勝敗のみ）
    ↓
連続挑戦 / タイトルへ戻る
```

### プレイ時間

- 1ラウンド: 30秒〜2分（1本勝負）
- 1試合=1ラウンドで結果確定
- テンポよく連戦可能

---

## 紙相撲メカニクス

### 基本原理

**連打 → 振動 → 運動**：

```
プレイヤーの連打
    ↓
振動エネルギー蓄積
    ↓
力士に前進力として伝達
    ↓
慣性・重力・摩擦の影響を受ける
    ↓
前に進む / 転倒する / 押し出される
```

### 2種類のプッシュボタン

#### 強プッシュ（Strong Push）

**特性**：
- 強い前進力（高速連打で最大効果）
- 重心が前に移動しやすい
- 前に倒れるリスク大

**連打効果**：
- 連打速度 → 前進速度（線形）
- 速すぎると前のめりになり転倒リスク増加

**戦略的使用**：
- 相手を土俵際に追い込む
- 距離を詰める
- リスク覚悟の勝負時

#### 弱プッシュ（Weak Push）

**特性**：
- 穏やかな前進力
- 重心が安定
- 前に倒れにくい

**連打効果**：
- 連打速度 → 前進速度（緩やか）
- 安定した姿勢を維持

**戦略的使用**：
- 安全に距離調整
- 相手の攻めを受け止める
- バランスを保ちながら前進

---

## 物理シミュレーション

### Three.jsベースの物理計算

**実装方針**：
- Three.jsの組み込み物理演算機能を使用
- シンプルな重力・慣性・摩擦
- カスタム転倒判定ロジック

### 力士の物理特性

```typescript
interface PhysicsActor {
  position: Vector3;       // 3D座標
  velocity: Vector3;       // 速度ベクトル
  rotation: Euler;         // 回転角度
  mass: number;            // 質量（固定: 1.0）
  centerOfGravity: Vector3; // 重心位置
  tipping: number;         // 傾き度合い（0-1）
}
```

**基本パラメータ**：
- 質量: 1.0（両者同じ）
- 摩擦係数: 0.7（土俵との摩擦）
- 重力: -9.8 m/s²（下向き）
- 空気抵抗: 0.1（速度減衰）

### 転倒判定

**転倒条件**（いずれかを満たすと転倒）：

1. **前傾角度**: `rotation.x > 45°`（前のめり）
2. **後傾角度**: `rotation.x < -45°`（後ろに倒れる）
3. **重心逸脱**: 重心が支持基底面（足の範囲）外

**転倒方向**：
- 前転倒: `rotation.x > 45°` → 前に倒れる
- 後転倒: `rotation.x < -45°` → 後ろに倒れる

**転倒後の処理**：
- 即座に試合終了
- 倒れた側が敗北

### 押し出し判定

**土俵外判定**：
- 力士の中心位置: `position.length() > ringRadius`（4.5ユニット）
- 即座に試合終了
- 土俵外に出た側が敗北

---

## 連打システム

### タップ検出

**連打速度の計測**：

```typescript
interface TapTracker {
  taps: number[];          // タップのタイムスタンプ配列
  window: number;          // 計測ウィンドウ（1秒）

  addTap(timestamp: number): void;
  getTapRate(): number;    // タップ/秒
}
```

**計算方法**：
- 過去1秒間のタップ数をカウント
- タップ数/秒 = 連打速度

### 連打速度 → 振動エネルギー変換

**強プッシュ**：

```typescript
// 連打速度（taps/sec）→ 前進力（units/sec）
function strongPushForce(tapRate: number): number {
  const baseForce = 0.5;       // 基本力
  const multiplier = 1.5;      // 連打速度係数
  return baseForce + (tapRate * multiplier);
}

// 傾き増加（連打速度に比例）
function tippingIncrease(tapRate: number): number {
  return tapRate * 0.01;  // 速いほど前傾しやすい
}
```

**弱プッシュ**：

```typescript
// 連打速度（taps/sec）→ 前進力（units/sec）
function weakPushForce(tapRate: number): number {
  const baseForce = 0.3;       // 基本力（強プッシュより弱い）
  const multiplier = 0.8;      // 連打速度係数（低め）
  return baseForce + (tapRate * multiplier);
}

// 傾き増加（ほぼなし）
function tippingIncrease(tapRate: number): number {
  return tapRate * 0.003;  // 安定性重視
}
```

### 振動エネルギーの減衰

**タップ後の減衰**：

```typescript
// 毎フレーム速度を減衰（摩擦）
velocity.x *= 0.95;  // 5%減速
velocity.z *= 0.95;

// 傾きも徐々に元に戻る（バランス調整）
tipping *= 0.98;  // 2%ずつ安定化
```

---

## 勝利条件

### 両方有効

**1. 相手を転倒させる**：
- 前転倒: 相手が前に倒れた（45°以上傾く）
- 後転倒: 相手が後ろに倒れた（-45°以上傾く）

**2. 相手を土俵外に押し出す**：
- 土俵中心から4.5ユニット超
- 相手の中心位置で判定

**3. 自滅を避ける**：
- 自分が転倒/土俵外 → 敗北
- 両者同時の場合 → 引き分け（リプレイ）

---

## AIシステム（対戦相手）

### AI行動パターン

**シンプルなルールベースAI**：

```typescript
// AIの判断ロジック
if (distanceToOpponent < 2.0) {
  // 近距離：強プッシュ連打で押し込む
  pressButton('strong', tapRate: 8-12);
} else if (myTipping > 0.6) {
  // 自分が傾いている：弱プッシュで安定化
  pressButton('weak', tapRate: 4-6);
} else if (opponentTipping > 0.5) {
  // 相手が不安定：強プッシュで攻める
  pressButton('strong', tapRate: 10-15);
} else {
  // 標準：弱プッシュで前進
  pressButton('weak', tapRate: 5-8);
}
```

**連打速度のバリエーション**：
- ランダム性を加えて人間らしさ
- tapRate ± 20%のブレ

---

## バランス設計

### パラメータ一覧

**基本設定**：

```typescript
const gameBalance = {
  // 力士
  actorMass: 1.0,
  friction: 0.7,

  // 重力・物理
  gravity: -9.8,
  airResistance: 0.1,

  // 転倒
  tippingThreshold: 0.45,  // 45度
  stabilizationRate: 0.98,

  // 土俵
  ringRadius: 4.5,

  // 強プッシュ
  strongBaseForce: 0.5,
  strongMultiplier: 1.5,
  strongTippingRate: 0.01,

  // 弱プッシュ
  weakBaseForce: 0.3,
  weakMultiplier: 0.8,
  weakTippingRate: 0.003,

  // AI
  aiTapRateMin: 4,
  aiTapRateMax: 15,
  aiRandomness: 0.2  // ±20%
};
```

### 試合時間バランス

**想定試合時間**：
- 1本勝負: 30秒〜2分
- 最速決着: 10-20秒（即押し出し）
- 長期戦: 2-3分（バランス攻防）

**調整の要素**：
- 前進力（連打効果）
- 摩擦係数（速度減衰）
- 転倒閾値（倒れやすさ）

---

## UXデザイン

### レトロスタイリング（MVP）

MVPでは8bitゲーム風のレトロデザインを採用します。

**カラーパレット**（ゲームボーイ風）：
```css
--retro-bg: #0f380f      /* 濃い緑（背景） */
--retro-fg: #9bbc0f      /* 明るい緑（文字） */
--retro-accent: #8bac0f  /* 中間緑（ボタン） */
--retro-dark: #306230    /* 暗い緑（影） */
```

**フォント**：
- PixelMplusフォント（日本語対応ドット絵フォント）

**UIコンポーネント**：
- 太いボーダー（4px）でクッキリした境界
- ボタンは押下時に色反転
- シンプルなドット絵アイコン

**画面レイアウト**：
- 上部: 傾きインジケーター（転倒危険度）
- 中央: 3D土俵（基本ジオメトリ）
- 下部: 2つのプッシュボタン（強/弱）

### フィードバック

**連打時**：
- 振動エフェクト（画面が微振動）
- タップ音（カタカタカタ）
- バイブレーション（対応端末）
- 力士が前進する様子

**転倒危険時**：
- 傾きインジケーターが赤く点滅
- 警告音
- 画面が傾きに応じて傾く（カメラエフェクト）

**勝利/敗北時**：
- 勝利: ファンファーレ + 勝者ポーズ
- 敗北: 倒れるアニメーション + 敗北音

### アクセシビリティ

**色弱対応**：
- 傾き度を色+形状で表示
- ボタン状態を色+明度で表示

**モーション感度**：
- 設定でカメラ振動を軽減
- 傾きエフェクト無効化

**タッチターゲット**：
- ボタンサイズ: 最低80×80px
- ボタン間隔: 最低15px
- 誤タップ防止

---

## 将来の拡張（Phase 3以降）

### 育成システム

**ステータス強化**：
- 重さ（押す力）
- バランス（転倒しにくさ）
- スピード（前進速度）

### 追加モード

**候補**：
- 2人対戦（ローカルマルチプレイ）
- トーナメントモード（連続対戦）
- エンドレスモード（何人倒せるか）

### オンライン対戦

**実装要素**：
- リアルタイムマッチング
- ランキングシステム
- リプレイ機能

---

## テストとバランス調整

### テスト項目

- [ ] 1本勝負平均時間が30秒〜2分
- [ ] 強プッシュ連打で10秒以内に決着（リスク相応）
- [ ] 弱プッシュのみで安定した勝利可能
- [ ] 転倒決着が50%前後
- [ ] 押し出し決着が50%前後
- [ ] AIとプレイヤーの勝率が40-60%

### フィードバック収集

**テストプレイヤー観察**：
- どちらのボタンを多用するか
- 転倒タイミング
- 試合時間の長さ
- 連打疲労度

**調整サイクル**：
1. パラメータ調整
2. テストプレイ
3. データ収集
4. 分析と再調整

---

## 参考資料

- 紙相撲の物理シミュレーション研究
- ゲームバランス理論
- 連打ゲームのUXベストプラクティス
