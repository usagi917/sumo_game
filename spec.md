# 相撲バトルゲーム 要件定義 / 開発プラン

## 📋 実装決定事項 (2025年1月)

### スコープ決定: M1-M2 フェーズのみ実装

**実装範囲**:
- ✅ コアバトルシステム（移動、押し、つっぱり、HP、土俵判定）
- ✅ スペシャル技2種 + ゲージシステム
- ✅ 簡易AI対戦
- ✅ UI/HUD（HP、ゲージ、操作ボタン）
- ✅ リザルト画面

**延期項目（Phase 3以降）**:
- ⏭️ 育成システム（日次強化、ステータス成長）
- ⏭️ オンライン対戦
- ⏭️ 追加スペシャル技
- ⏭️ チュートリアル

**理由**: MVPとして最小限のコアバトル体験を先に完成させ、フィードバックを得てから拡張する。

### 技術スタック確定

| 分野 | 採用技術 | 選定理由 |
|------|---------|---------|
| **3Dレンダリング** | Three.js + @react-three/fiber | React統合、軽量、基本ジオメトリで十分 |
| **状態管理** | Zustand | 最軽量、ボイラープレート最小、TypeScript対応 |
| **レトロスタイル** | CSS + PixelMplus font | 開発コスト最小、柔軟な変更可能、バンドル増加なし |
| **フレームワーク** | Vite + React + TypeScript | 高速ビルド、モダンな開発体験 |
| **型定義** | TypeScript (strict mode) | 型安全性、リファクタリング容易性 |
| **デプロイ** | Vercel (静的ビルド) | 高速CDN、自動最適化、無料枠十分 |

**不採用の選択肢**:
- ❌ Unity WebGL: ビルドサイズ大、WebGLビルド不安定
- ❌ Babylon.js: 高機能だがオーバースペック
- ❌ Phaser.js: 2D向け、3D要件満たせず
- ❌ Redux: ボイラープレート過剰
- ❌ **cannon-es (物理エンジン)**: MVPに不要、シンプルな座標計算で代替

### アーキテクチャ方針

**Modular Design (Bricks & Studs)**:
- **Types Module** (`src/types/`): 共有型定義（Studs）
- **State Module** (`src/state/`): Zustandストア
- **Game Systems** (`src/game/systems/`): 物理、アクション、ゲージ
- **Game Actors** (`src/game/actors/`): 力士、土俵コンポーネント
- **UI Module** (`src/ui/`): HUD、コントロール

**設計原則**:
- **Ruthless Simplicity**: 最小限から始め、必要に応じて成長
- **Bricks (モジュール)**: 自己完結型、仕様から再生成可能
- **Studs (インターフェース)**: 明確な接続点、型定義で保証

### ディレクトリ構造

```
/Users/you/programming/sumo_game/
├── src/
│   ├── types/           # 型定義（studs）
│   ├── state/           # 状態管理
│   ├── game/
│   │   ├── systems/     # movement.ts, actions.ts, gauge.ts, ai.ts
│   │   ├── actors/      # Sumo.tsx, Ring.tsx
│   │   └── GameScene.tsx  # 3Dシーン統合（カメラ、ライト含む）
│   ├── ui/
│   │   ├── hud/         # HPBar.tsx, GaugeBar.tsx, HUD.tsx
│   │   ├── controls/    # ActionButtons.tsx
│   │   └── screens/     # TitleScreen.tsx, ResultScreen.tsx
│   └── styles/          # レトロスタイル
│       ├── retro.css    # 8bitカラーパレット
│       └── fonts.css    # ドット絵フォント（PixelMplus）
├── docs/                # 詳細ドキュメント
│   ├── ARCHITECTURE.md  # システム設計
│   ├── GAME_DESIGN.md   # ゲームメカニクス
│   └── CONTROLS.md      # 操作仕様
├── spec.md              # このファイル
└── package.json         # 依存関係

```

### ドキュメント

詳細は以下を参照:
- [README.md](./README.md) - プロジェクト概要とクイックスタート
- [docs/ARCHITECTURE.md](./docs/ARCHITECTURE.md) - システム設計とモジュール構造
- [docs/GAME_DESIGN.md](./docs/GAME_DESIGN.md) - ゲームメカニクスとバランス
- [docs/CONTROLS.md](./docs/CONTROLS.md) - 操作システムとUI仕様

---

## 1. 目的とコンセプト
- スマホ・タブレットでタッチ操作できるレトロ風3D相撲バトルゲーム。
- 俯瞰斜め視点で土俵全体を把握しながら、簡単操作で駆け引きを楽しむ。
- 8bitカラーとドット絵風フォントで懐かしいゲーム感を演出。
- MVPでは1本勝負のシンプルバトルに集中し、育成システムは将来拡張。

## 2. 対応プラットフォーム / 実行環境
- Webアプリ (PWA対応を視野)。
- デバイス: iOS/Android スマホ・タブレット（縦持ち優先、横持ちでも破綻しないレイアウト）。
- 入力: タッチ操作のみ。ジェスチャはシンプル化し、誤タップ防止のボタン間隔を確保。
- 想定フレームレート: 30fps安定を最低ライン、可能なら60fps。

## 3. カメラ・表示
- 3Dシーン。カメラは土俵を斜め上から見る固定～軽微な追従視点。
- 土俵全体と両力士の位置が常に見えること。
- ズーム: 自動で微調整（力士が離れすぎ/寄りすぎた際に軽くズーム）。

## 4. 操作仕様（バトル）
- 画面右下に主要アクションボタンを3つ以上配置。
  - 例: `押す`（近距離押し出し）, `つっぱり`（連打系攻撃）, `スペシャル`（ゲージ消費技）。
- クールダウン: 各ボタンに個別CDを設定し、連打ゲー化を防ぐ。
- 入力フィードバック: ボタン点灯/縮みアニメ、バイブレーション（対応端末のみ）。

## 5. スペシャル技
- 最低2種類実装（例: 渾身押し出し、豪腕ぶっ飛ばし）。
- 共通ゲージ制: 攻撃ヒットや被弾で増加、満タンで解放。
- 発動演出: スロー演出やエフェクトでドラマチックに（1秒以内で復帰）。

## 6. ステータス育成（Phase 3以降）
MVPではシンプルな1本勝負に集中するため、育成システムは将来実装に延期。

**計画中の育成仕様**:
- パラメータ: 力・速さ・体力 の3つ。
- 1日につき1項目だけ上げられる（日次リソース配分の意思決定）。
- 成長効果例:
  - 力: 押し/つっぱりの威力とノックバック距離に影響。
  - 速さ: 移動速度と攻撃出の速さに影響。
  - 体力: HPとスタン耐性に影響。
- デイリー経過はアプリ内カレンダー/サーバ時刻で管理できるよう設計（オフライン時の扱いは要検討）。

## 7. ゲームフロー（MVP実装）
MVPでは育成システムを省き、シンプルなバトル体験に集中。

1. **タイトル画面** → 試合開始を選択
2. **バトル** → 1本勝負（AI対戦、1ラウンド1〜2分）
3. **リザルト** → 勝敗結果表示、連続挑戦またはタイトルへ

**将来拡張** (Phase 3):
- デイリー育成画面で力・速さ・体力を選択強化
- 番付システム（勝てば昇格、負ければ降格）
- 経験値とゲージ説明

## 8. UI/UX要件

**レトロデザイン**:
- **8bitカラーパレット**: CRT風の色彩で懐かしさを演出
- **ドット絵フォント**: PixelMplusフォントで統一感
- **シンプルなボタン**: 押す、つっぱり、スペシャルの3つのみ

**操作性**:
- 片手操作を意識し、主要ボタンは親指が届くゾーンに集約。
- 重要情報: ゲージ/HP/ラウンド数を画面上部にまとめて常時表示。

**アクセシビリティ**:
- 色弱対応: コントラスト比確保、ボタン形状差で状態を示す。

**将来拡張** (Phase 3):
- チュートリアル: 初回起動時に1分以内で操作を教えるオンボーディング。

## 9. 技術スタック
- **3Dレンダリング**: Three.js + @react-three/fiber（基本ジオメトリのみ）
- **フレームワーク**: Vite + React + TypeScript
- **状態管理**: Zustand（最軽量、ボイラープレート最小）
- **レトロスタイル**: CSS + PixelMplusフォント（バンドル増加なし）
- **衝突判定**: シンプルな座標計算（物理エンジン不使用）
- **入力**: ポインタ/タッチイベントを抽象化したInputレイヤー
- **アセット**: 基本ジオメトリ（Box、Cylinder等）、テクスチャ最適化
- **デプロイ**: Vercel（静的ビルド、CDN最適化）

## 10. パフォーマンス/品質
- **目標ロード時間**: 初回3秒以内（Wi-Fi環境）
- **バンドルサイズ**: 1.5MB以下（物理エンジン削除により軽量化）
- **FPS目標**: 30fps以上（モバイル）、可能なら60fps
- **最適化手法**:
  - 基本ジオメトリのみ使用（頂点数最小化）
  - ポストエフェクト最小化
  - 低端末向けクオリティプリセット
  - Vercel CDN活用

## 11. サウンド
- 効果音: 技ヒット、スペシャル発動、土俵から落ちる音。
- BGM: ループ1〜2曲（ミュートボタン必須）。
- バイブレーション: スペシャル発動時に軽く振動（対応端末のみ）。

## 12. データ管理
**MVP実装**:
- 設定: 音量・バイブ・グラフィック品質をローカルストレージに保存

**将来拡張** (Phase 3):
- ステータス/デイリー強化の保存
- バックエンド同期によるクロスデバイス対応

## 13. テスト観点（MVP）
**デバイス互換性**:
- iOS Safari / Chrome、Android Chrome、iPad Safari

**操作テスト**:
- ボタン同時押し、長押し、連打時の挙動
- タッチ精度、誤タップ防止

**ゲーム機能**:
- ゲージ増減、満タン判定、スペシャル発動後のリセット
- HP減少、土俵外判定、勝敗判定
- AI対戦の挙動

**将来テスト** (Phase 3):
- 育成: 日付変更処理、オフライン時の強化記録、端末時刻改ざん耐性

## 14. マイルストーン

### Phase 1-2: コアバトル実装（現在のスコープ）

**M1: コアバトルシステム**
- ✅ 移動・押し/つっぱり実装
- ✅ HP/ダメージシステム
- ✅ 土俵外判定（落下）
- ✅ 簡易AI対戦
- ✅ 基本UI（HP、ラウンド表示）

**M2: スペシャル技＋演出**
- ✅ スペシャル技2種（強押し出し、連撃バースト）
- ✅ ゲージシステム（0-100、攻撃/被弾で増加）
- ✅ 発動演出（カメラズーム、スローモーション）
- ✅ 完全なUI（ゲージ表示、操作ボタン）
- ✅ リザルト画面

### Phase 3以降: 拡張機能（将来実装）

**M3: 育成システム**
- ⏭️ デイリー育成UI
- ⏭️ ステータス成長（力・速さ・体力）
- ⏭️ パラメータの試合への反映
- ⏭️ 日付管理システム

**M4: 完成度向上**
- ⏭️ チュートリアル
- ⏭️ UI磨き（アニメーション、エフェクト）
- ⏭️ パフォーマンス最適化
- ⏭️ PWA対応（オフライン動作、ホーム画面追加）

**M5: オンライン対戦（検討中）**
- ⏭️ マッチメイキング
- ⏭️ リアルタイム/非同期対戦
- ⏭️ ランキングシステム

## 15. MVP完了後の検討事項
MVPフィードバックを得た後、Phase 3以降で検討:

- **育成システム**: 日次強化、ステータス成長、番付システム
- **オンライン対戦**: リアルタイム vs 非同期の選択
- **収益化**: 広告/課金モデル（スキン販売、時短アイテム等）
- **セキュリティ**: 端末時刻改ざん対策レベル（サーバ検証の必要性）
- **表現規制**: 年齢層ターゲットに応じたエフェクト強度・効果音調整
- **チュートリアル**: 初回起動時のオンボーディング体験

---

## 実装準備完了
本仕様に基づき、以下のドキュメントで詳細設計を参照:
- [docs/ARCHITECTURE.md](./docs/ARCHITECTURE.md) - システム設計とモジュール構造
- [docs/GAME_DESIGN.md](./docs/GAME_DESIGN.md) - ゲームメカニクスとバランス
- [docs/CONTROLS.md](./docs/CONTROLS.md) - 操作システムとUI仕様
